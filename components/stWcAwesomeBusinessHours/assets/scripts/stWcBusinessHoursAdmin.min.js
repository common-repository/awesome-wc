Vue.component("st-wc-business-hours-admin",{props:{pluginName:{type:String,default:"Awesome Business Hours"},settings:{type:Object},forms:{type:Array}},data(){return{enabled:this.settings.enabled,sunday:this.settings.sunday,monday:this.settings.monday,tuesday:this.settings.tuesday,wednesday:this.settings.wednesday,thursday:this.settings.thursday,friday:this.settings.friday,saturday:this.settings.saturday,highlightCurrent:this.toBool(this.settings.highlightCurrent),highlightColor:this.settings.highlightColor,highlightStyle:this.settings.highlightStyle,currentDayOnly:this.toBool(this.settings.currentDayOnly),dense:this.toBool(this.settings.dense),format24hour:this.toBool(this.settings.format24hour),pattern24hour:"([01]?[0-9]|2[0-3]):[0-5][0-9]",pattern12hour:"(1[0-2]|0?[1-9]):[0-5][0-9]\\s?([ap]m)",highlightStyles:[{name:"dark",icon:"mdi-moon-waning-crescent"},{name:"light",icon:"mdi-white-balance-sunny"}]}},mounted(){stBus.$on("update-setting",({option:option,value:value,encode:encode})=>{this[option]=value,this.update(option,value,encode)})},beforeDestroy(){stBus.$off("update-setting")},methods:{toBool:value=>[1,"1",!0,"true"].includes(value),isValid(option,value){switch(option){case"enabled":case"currentDayOnly":case"highlightCurrent":case"dense":case"format24hour":return[!0,!1].includes(value);case"highlightStyle":return["light","dark"].includes(value);case"sunday":case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":const closed=[!0,!1].includes(value.closed),hours=this.regexp.test(value.opens+"-"+value.closes);return closed&&hours;case"highlightColor":return/^#([0-9A-F]{3}){1,2}$/i.test(value);default:return!1}},update(option,value,encode){if(!this.isValid(option,value))return;const data=new FormData;data.set("action","st_wc_business_hours_update_option"),data.set("option",option),data.set("value",encode?JSON.stringify(value):value),axios.post(ajaxurl,data).then(response=>{stBus.$emit("show-alert",response.data),response.data.status||stBus.$emit("setting-error",{option:option,value:value})}).catch(error=>{})}},computed:{days(){return this.forms.filter(form=>"day"===form.type)},switches(){return this.forms.filter(form=>"switch"===form.type)},selects(){return this.forms.filter(form=>"select"===form.type)},regexp(){const separator="\\s?-\\s?",pattern=this.format24hour?this.pattern24hour:this.pattern12hour,regexp="^"+pattern+separator+pattern+"$";return new RegExp(regexp,"mi")}}});