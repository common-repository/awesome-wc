Vue.component("st-wc-admin",{props:{pluginName:{type:String,default:"Awesome Component Manager"},products:{type:Array,default:function(){return[]}},adminUrl:{type:String,default:""},nonce:{type:String,default:""},planNonce:{type:String,default:""},bundle:{type:Object,default:()=>({})}},data:()=>({localProducts:[],licenseDialog:!1,planDialog:!1,progressDialog:!1,licenseKey:"",planKey:"",selected:null,activating:!1,alert:!1,alertColor:"error",alertMessage:"",error:""}),mounted(){this.localProducts=this.products.slice()},watch:{licenseDialog(v){v?null!=this.$refs.license&&this.$refs.license.focus():(this.licenseKey="",this.error="",this.alert=!1)},planDialog(v){v?null!=this.$refs.plan&&this.$refs.plan.focus():(this.planKey="",this.error="",this.alert=!1)}},computed:{componentsAvailable(){let available=this.localProducts.filter(c=>!c.installed);return null==available||null==available?[]:available}},methods:{openLicenseDialog(component){this.selected=component,null==this.bundle||null==this.bundle||this.bundle.expired?this.licenseDialog=!0:(console.log(this.bundle),this.progressDialog=!0,this.downloadWithPlanLicense())},isValid(){let errorFound=!1;return this.error="",this.alert=!1,null!=this.licenseKey&&null!=this.licenseKey&&0!=this.licenseKey.length||(errorFound=!0,this.error="required"),!errorFound},activateLicense(){if(!this.isValid())return;let action=this.selected.installed?"st_wc_activate_license":"st_wc_activate_download",formData=new FormData;formData.set("action",action),formData.set("licenseKey",this.licenseKey),formData.set("productId",this.selected.productId),formData.set("wpnonce",this.nonce),this.activating=!0,axios.post(ajaxurl,formData).then(response=>{this.activating=!1,"error"==response.data.resultType?(this.alertMessage=this.getMessage(response.data.message),this.alertColor="error",this.alert=!0):location.reload()}).catch(error=>{this.activating=!1})},isPlanValid(){let errorFound=!1;return this.error="",this.alert=!1,null!=this.planKey&&null!=this.planKey&&0!=this.planKey.length||(errorFound=!0,this.error="required"),!errorFound},activatePlan(){if(!this.isPlanValid())return;let formData=new FormData;formData.set("action","st_wc_activate_plan"),formData.set("planKey",this.planKey),formData.set("wpnonce",this.planNonce),this.activating=!0,axios.post(ajaxurl,formData).then(response=>{this.activating=!1,"error"==response.data.resultType?(this.alertMessage=this.getMessage(response.data.message),this.alertColor="error",this.alert=!0):location.reload()}).catch(error=>{this.activating=!1})},update(component){const formData=new FormData;formData.set("action","st_wc_update_component"),formData.set("productId",component.productId),formData.set("wpnonce",this.nonce),component.updating=!0,axios.post(ajaxurl,formData).then(response=>{component.updating=!1,this.errorMessage=response.data.error?response.data.message:"",response.data.error||(component.installedVersion=component.version,component.needUpdate=!1)}).catch(error=>{component.updating=!1})},download(component){const formData=new FormData;formData.set("action","st_wc_download_component"),formData.set("productId",component.productId),formData.set("wpnonce",this.nonce),component.updating=!0,axios.post(ajaxurl,formData).then(response=>{component.updating=!1,this.errorMessage=response.data.error?response.data.message:"",response.data.error||location.reload()}).catch(error=>{component.updating=!1})},downloadWithPlanLicense(){const formData=new FormData;formData.set("action","st_wc_download_component"),formData.set("productId",this.selected.productId),formData.set("licenseKey",this.bundle.licenseCode),formData.set("wpnonce",this.nonce),axios.post(ajaxurl,formData).then(response=>{this.errorMessage=response.data.error?response.data.message:"",response.data.errors&&(this.alertMessage=this.getMessage(response.data.message),this.alertColor="error",this.alert=!0),location.reload()}).catch(error=>{})},getMessage(error){switch(error){case"expired":return"The license has expired.";case"invalid":return"Invalid license key for this product.";case"fail":return"Access denied."}if("object"==typeof error){let errors="";for(const property in error)errors+=error[property];return errors}}}});